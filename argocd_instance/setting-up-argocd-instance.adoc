:_mod-docs-content-type: ASSEMBLY
include::_attributes/common-attributes.adoc[]
[id="setting-up-argocd-instance"]
= Setting up an Argo CD instance
:context: setting-up-argocd-instance

toc::[]

By default, {gitops-title} installs an instance of Argo CD in the `openshift-gitops` namespace with additional permissions for managing certain cluster-scoped resources. This default Argo CD instance is also called as the default cluster-scoped instance.

To prevent the default Argo CD instance from starting in the `openshift-gitops` namespace, you can use the `openshift-gitops-operator` subscription and configure the `DISABLE_DEFAULT_ARGOCD_INSTANCE` environment variable in it by setting the string value to `"true"`.

[NOTE]
====
For {gitops-shortname} version 1.13 and later:

* Route TLS termination is set as default to the `reencrypt` mode for both the default and user-defined Argo CD instances. TLS connections to the Argo CD instances now receive the default ingress certificate that is set in {OCP}, instead of the self-signed Argo CD certificate. You can modify the route TLS termination policy by configuring the `.spec.server.route.tls` field of the Argo CD CR.

* Restricted pod security admission (PSA) labels are applied to the `openshift-gitops` namespace to ensure compliance with {OCP} standards. If you are running additional workloads in this namespace, such as monitoring or logging, ensure that they comply with the restricted PSA requirements. If compliance is not feasible, consider using a user-defined, cluster-scoped Argo CD instance, where PSA labels are not applied or controlled by the {gitops-shortname} Operator.
====

To manage cluster configurations or deploy applications, you can install and deploy a new user-defined Argo CD instance. By default, any new user-defined instance has permissions to manage resources only in the namespace where it is deployed.

[WARNING]
====
* A Kubernetes user with access to the Argo CD namespace is an Argo CD administrator and can bypass any role-based access control (RBAC) restrictions configured in Argo CD. Never grant non-administrator users any read or write access to the Argo CD namespace.
* If non-administrator users create applications, do not allow them to be bound to the default `AppProject` custom resource (CR) because it has no restrictions. Otherwise, the Kubernetes permissions of the Argo CD instances and the default `AppProject` CR allow deployment of everything everywhere. To prevent this situation, lock down the default `AppProject` CR so that no one can use it accidentally, even if someone misconfigures the Argo CD RBAC.
====

You can create a user-defined Argo CD instance in any namespace, other than the `openshift-gitops` namespace.

[IMPORTANT]
====
If you want to create a user-defined Argo CD instance within the `openshift-gitops` namespace, set the `DISABLE_DEFAULT_ARGOCD_INSTANCE` flag value in the `openshift-gitops-operator` subscription to `"true"` and do not name the instance as `openshift-gitops`.
====

// Installing an Argo CD instance
include::modules/gitops-argo-cd-installation.adoc[leveloffset=+1]
[role="_additional-resources"]
.Additional resources 
* link:https://argocd-operator.readthedocs.io/en/latest/usage/routes/#setting-tls-modes-for-routes[Configuring the route TLS termination]
* xref:../argocd_instance/argo-cd-cr-component-properties.adoc#argo-cd-properties_argo-cd-cr-component-properties[Argo CD custom resource properties]
* link:https://docs.openshift.com/container-platform/latest/rest_api/network_apis/route-route-openshift-io-v1.html#spec-tls[Specification for TLS termination configuration]
* link:https://argocd-operator.readthedocs.io/en/latest/usage/ha/repo-server[Persistent volumes for repo server storage]
* xref:../declarative_clusterconfig/configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations.adoc#using-argo-cd-instance-to-manage-cluster-scoped-resources_configuring-an-openshift-cluster-by-deploying-an-application-with-cluster-configurations[Using an Argo CD instance to manage cluster-scoped resources]
* xref:../declarative_clusterconfig/customizing-permissions-by-creating-user-defined-cluster-roles-for-cluster-scoped-instances.adoc#gitops-disabling-the-creation-of-the-default-cluster-roles-for-the-cluster-scoped-instance_customizing-permissions-by-creating-user-defined-cluster-roles-for-cluster-scoped-instances[Disabling the creation of the default cluster roles for the cluster-scoped instance]
* link:https://argocd-operator.readthedocs.io/en/stable/reference/argocd/#controller-options[Configuring Argo CD controller options]
* link:https://argocd-operator.readthedocs.io/en/stable/reference/argocd/#server-options[Configuring Argo CD server options]

// Configuring common cluster roles by specifying user-defined cluster roles for namespace-scoped instances
include::modules/gitops-configuring-common-cluster-roles-by-specifying-user-defined-cluster-roles-for-namespace-scoped-instances.adoc[leveloffset=+1]
[role="_additional-resources"]
.Additional resources 
* xref:../declarative_clusterconfig/customizing-permissions-by-creating-user-defined-cluster-roles-for-cluster-scoped-instances.adoc#customizing-permissions-by-creating-user-defined-cluster-roles-for-cluster-scoped-instances[Customizing permissions by creating user-defined cluster roles for cluster-scoped instances]
* xref:../declarative_clusterconfig/customizing-permissions-by-creating-aggregated-cluster-roles.adoc#customizing-permissions-by-creating-aggregated-cluster-roles[Customizing permissions by creating aggregated cluster roles]

// Enabling replicas for Argo CD server and repo server
include::modules/gitops-enable-replicas-for-argo-cd-server.adoc[leveloffset=+1]

// Deploying resources to a different namespace
include::modules/gitops-deploy-resources-different-namespaces.adoc[leveloffset=+1]

// Customizing the Argo CD console link
include::modules/gitops-customize-argo-cd-consolelink.adoc[leveloffset=+1]
