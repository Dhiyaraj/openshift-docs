// Module included in the following assemblies:
//
// * work_with_shared_resources/using-shared-resource-csi-driver.adoc

:_mod-docs-content-type: PROCEDURE

[id="ephemeral-storage-sharing-configmaps-across-namespaces_{context}"]
= Sharing a config map across namespaces

To share a config map across namespaces in a cluster, you create a `SharedConfigMap` custom resource (CR) instance.

.Prerequisites

You must have permissions to perform the following actions:

* Create `sharedconfigmaps.sharedresource.openshift.io` custom resource definition (CRD) at a cluster-scoped level.
* Create a `ClusterRole` object for the `SharedConfigMap` CR.
* Create role and role binding for the Shared Resource Container Storage Interface (CSI) Driver.
* Manage roles and role bindings across the namespaces in the cluster to control which users can get, list, and watch those instances.
* Manage roles and role bindings across the namespaces in the cluster to control which service accounts in pods that mount your CSI volume can use those instances.
* Access the namespaces that contain the secrets you want to share.

.Procedure

. Create a `SharedConfigMap` CR instance for the config map that you want to share across namespaces in the cluster. See the following example configuration:
+
[source,yaml]
----
apiVersion: sharedresource.openshift.io/v1alpha1
kind: SharedConfigMap
metadata:
  name: share-test-config <1>
spec:
  configMapRef:
    name: shared-config
    namespace: <name_of_the_source_namespace> <2>
----
<1> Defines the name of the `SharedConfigMap` CR.
<2> Replace `<name_of_the_source_namespace>` with the name of your source namespace.

. Create a `ClusterRole` CR instance that grants Role-based access control (RBAC) permission to use the referenced shared resource by using the following example configuration:
+
[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: <cluster_role_name> <1>
rules:
  - apiGroups:
      - sharedresource.openshift.io
    resources:
      - sharedconfigmaps
    resourceNames:
      - share-test-config <2>
    verbs:
      - use
----
<1> Replace <cluster_role_name> with the name of your cluster role.
<2> Defines the name of the `SharedSecret` CR.

. Create a `Role` and `RoleBinding` object to grant the CSI driver permission to access the config map:
+
.Example `Role` object
[source,yaml]
----
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: shared-test-config
  namespace: test-share-source <1>
rules:
  - apiGroups: [""]
    resources: ["configmaps"]
    resourceNames: ["shared-config"]
    verbs: ["get", "list", "watch"]
----
<1> Defines the name of the source namespace.

+
.Example `RoleBinding` object
[source,yaml]
----
 apiVersion: rbac.authorization.k8s.io/v1
 kind: RoleBinding
 metadata:
   name: shared-test-config
   namespace: test-share-source <1>
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: Role
   name: shared-test-config
 subjects: <2>
   - kind: ServiceAccount
     name: csi-driver-shared-resource
     namespace: openshift-builds
----
<1> Defines the name of the source namespace.
<2> Defines a list of service accounts for the Shared Resource CSI driver DaemonSet. When deployed with Builds for OpenShift, the service account name is `csi-driver-shared-resource`, and the namespace is same where the Builds for OpenShift Operator is deployed.