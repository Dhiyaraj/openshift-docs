// Module included in the following assemblies:
//
// * service-mesh-docs-main/install/ossm-v2-v3-side-by-side-assembly.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-running-v2-v3-multitenant-deployment-model_{context}"]
= Running {SMProduct} 2.6 and {SMProduct} 3 using multi-tenant deployment model
//TP1 content influx. Title, etc may change.
//No IA as of 10/23/2024 so this content is likely to move.

If you are moving from {SMProductName} 2.6 from the default multi-tenant deployment model, you can run {SMProduct} 2.6 side-by-side with {SMProduct} 3.0, in one cluster, without them interfering with each other.

In {SMProduct} 2.6, you can check your deployment model from the `ServiceMeshControlPlane` under `spec.mode`:

.Example `ServiceMeshControlPlane` yaml
[source, yaml]
----
apiVersion: maistra.io/v2
kind: ServiceMeshControlPlane
metadata:
  name: basic
spec:
  mode: MultiTenant
----

//NOTES: 10/23/2024

//DO NOT USE VERSION NUMBER ATTRIBUTE. It is set for 3.0, will likely change, and it is unclear if later versions would impact this procedure for moving from 2.6.
//Only moving from 2.6 has been tested and verified by QE.
//Mulitenant has no changes to OSSM 2.6, separate module.

.Prerequisites

* You are running {ocp-product-title} 4.14 or later.
* You are running {SMProduct} 2.6.
+
[IMPORTANT]
====
If you are not running {SMProduct} 2.6, you must upgrade to 2.6 before following this procedure. To upgrade to {SMProduct} version to 2.6, see: link:https://docs.openshift.com/container-platform/4.17/service_mesh/v2x/upgrading-ossm.html[Upgrading Service Mesh 2.x]
====

.Procedure

. Install the {SMProduct} 3 Operator.

. Create an `IstioCNI` resource in the `istio-cni` namespace.

. Create an `Istio` resource in a different namespace than the namespace used in the `ServiceMeshControlPlane` resource in {SMProduct} 2.6. This example uses the `istio-system3` namespace:
+
.Example `Istio` resource with `istio-system3`
[source, yaml]
----
kind: Istio
piVersion: sailoperator.io/v1alpha1
metadata:
  name: ossm3 # <1>
spec:
  namespace: istio-system3 # <2>
  values:
    meshConfig:
      discoverySelectors: # <3>
        - matchExpressions:
          - key: maistra.io/member-of
            operator: DoesNotExist
  updateStrategy:
    type: InPlace
  version: v1.23.0
----
<1> Do not use `default` as the name.
<2> Must be different from the namespace used in the `ServiceMeshControlPlane` resource in {SMProduct} 2.6. This example uses the `istio-system3` namespace.
<3> To ignore {SMProduct} 2.6 namespaces, configure the `discoverySelectors` section as shown. All other namespaces will be part of the {SMProduct} 3.0 mesh.

. Deploy your workloads and label the namespaces with `istio.io/rev=ossm3` label by running the following command:
+
[source, terminal]
----
$ oc label namespace <namespace-name> istio.io/rev=<revision-name>
----
+
[NOTE]
====
If you have changed `spec.memberSelectors` in `ServiceMeshMemberRoll` in the `ServiceMeshControlPlane` resource in {SMProduct} 2.6., then use the `istio-injection=enabled` label for your {SMProduct} 3.0 workload namespaces.
====

. Confirm the application workloads are managed by their respective control planes by running the following command:
+
[source,terminal]
----
$ istioctl ps -i istio-system
----
+
.Sample output `istio-system`
[source, terminal]
----
$ istioctl ps -i istio-system
NAME                                          CLUSTER        CDS        LDS        EDS        RDS        ECDS         ISTIOD                                          VERSION
details-v1-7f46897b-88x4l.bookinfo            Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
mongodb-v1-6cf7dc9885-7nlmq.bookinfo          Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
mysqldb-v1-7c4c44b9b4-22b57.bookinfo          Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
productpage-v1-6f9c6589cb-l6rvg.bookinfo      Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
ratings-v1-559b64556-f6b4l.bookinfo           Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
ratings-v2-8ddc4d65c-bztrg.bookinfo           Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
ratings-v2-mysql-cbc957476-m5j7w.bookinfo     Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
reviews-v1-847fb7c54d-7dwt7.bookinfo          Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
reviews-v2-5c7ff5b77b-5bpc4.bookinfo          Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
reviews-v3-5c5d764c9b-mk8vn.bookinfo          Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-install-istio-system-bd58bdcd5-2htkf     1.20.8
----
+
.Sample output `istio-system3`
[source,terminal]
----
$ istioctl ps -i istio-system3
NAME                                          CLUSTER        CDS                LDS                EDS                RDS                ECDS        ISTIOD                            VERSION
details-v1-57f6466bdc-5krth.bookinfo2         Kubernetes     SYNCED (2m40s)     SYNCED (2m40s)     SYNCED (2m34s)     SYNCED (2m40s)     IGNORED     istiod-ossm3-5b46b6b8cb-gbjx6     1.23.0
productpage-v1-5b84ccdddf-f8d9t.bookinfo2     Kubernetes     SYNCED (2m39s)     SYNCED (2m39s)     SYNCED (2m34s)     SYNCED (2m39s)     IGNORED     istiod-ossm3-5b46b6b8cb-gbjx6     1.23.0
ratings-v1-fb764cb99-kx2dr.bookinfo2          Kubernetes     SYNCED (2m40s)     SYNCED (2m40s)     SYNCED (2m34s)     SYNCED (2m40s)     IGNORED     istiod-ossm3-5b46b6b8cb-gbjx6     1.23.0
reviews-v1-8bd5549cf-xqqmd.bookinfo2          Kubernetes     SYNCED (2m40s)     SYNCED (2m40s)     SYNCED (2m34s)     SYNCED (2m40s)     IGNORED     istiod-ossm3-5b46b6b8cb-gbjx6     1.23.0
reviews-v2-7f7cc8bf5c-5rvln.bookinfo2         Kubernetes     SYNCED (2m40s)     SYNCED (2m40s)     SYNCED (2m34s)     SYNCED (2m40s)     IGNORED     istiod-ossm3-5b46b6b8cb-gbjx6     1.23.0
reviews-v3-84f674b88c-ftcqg.bookinfo2         Kubernetes     SYNCED (2m40s)     SYNCED (2m40s)     SYNCED (2m34s)     SYNCED (2m40s)     IGNORED     istiod-ossm3-5b46b6b8cb-gbjx6     1.23.0
----