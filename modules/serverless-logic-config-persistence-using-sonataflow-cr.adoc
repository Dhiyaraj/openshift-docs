// Module included in the following assemblies:
// * serverless-logic/serverless-logic-managing-persistence


:_mod-docs-content-type: PROCEDURE
[id="serverless-logic-config-persistence-using-sonataflow-cr_{context}"]
= Configuring persistence using the SonataFlow CR

The `SonataFlow` custom resource (CR) enables workflow-specific persistence configuration. You can use this configuration independently, even if `SonataFlowPlatform` persistence is already set up in the current namespace.

.Procedure

* Configure persistence by using the `persistence` field in the `SonataFlow` CR specification as shown in the following example:

[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlow
metadata:
  name: example-workflow
  annotations:
    sonataflow.org/description: Example Workflow
    sonataflow.org/version: 0.0.1
spec:
  persistence:
    postgresql:
      serviceRef:
        name: postgres-example <1>
        namespace: postgres-example-namespace <2>
        databaseName: example-database <3>
        databaseSchema: example-schema <4>
        port: 1234 <5>
      secretRef:
        name: postgres-secrets-example <6>
        userKey: POSTGRESQL_USER <7>
        passwordKey: POSTGRESQL_PASSWORD <8>
  flow:
----
<1> Name of the Kubernetes Service that connects to the PostgreSQL database server.
<2> Optional: Namespace containing the PostgreSQL Service. Defaults to the workflow namespace.
<3> Name of the PostgreSQL database where workflow data is stored.
<4> Optional: Name of the database schema for workflow data. Defaults to the workflow name.
<5> Optional: Port to connect to the PostgreSQL Service. Defaults to `5432`.
<6> Name of the Kubernetes Secret containing database credentials.
<7> Key in the `Secret` object containing the database username.
<8> Key in the `Secret` object containing the database password.

This configuration informs the {ServerlessLogicOperatorName} that the workflow must connect to the specified PostgreSQL database server when deployed. The {ServerlessLogicOperatorName} adds the relevant JDBC connection parameters as environment variables to the workflow container.

[NOTE]
====
PostgreSQL is currently the only supported database for persistence.
====

For `SonataFlow` CR deployments using the `preview` profile, the {ServerlessLogicProductName} build system includes the required Quarkus extensions to enable persistence automatically.



