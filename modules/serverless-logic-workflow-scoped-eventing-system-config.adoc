// Module included in the following assemblies:
// * serverless-logic/serverless-logic-workflow-eventing-system

:_mod-docs-content-type: CONCEPT
[id="serverless-logic-workflow-scoped-eventing-system-config_{context}"]
= Workflow-scoped eventing system configuration

A workflow-scoped eventing system configuration allows for detailed customization of the events produced and consumed by a specific workflow. You can use the `spec.sink.ref` and `spec.sources[]` fields in the `SonataFlow` CR to configure outgoing and incoming events.

[id="serverless-logic-outgoing-eventing-system-config_{context}"]
== Outgoing eventing system configuration

To configure outgoing events, you can use the `spec.sink.ref` field in the `SonataFlow` CR. This configuration ensures the workflow produces events using the specified Knative Eventing Broker, including both system events and workflow business events.

The following example displays how to configure the `SonataFlow` CR for a workflow-scoped outgoing eventing system:
 
[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlow
metadata:
  name: example-workflow
  namespace: example-workflow-namespace
  annotations:
    sonataflow.org/description: Example Workflow
    sonataflow.org/version: 0.0.1
    sonataflow.org/profile: preview
spec:
  sink:
    ref:
      name: outgoing-example-broker <1>
      namespace: outgoing-example-broker-namespace <2>
      apiVersion: eventing.knative.dev/v1
      kind: Broker
  flow: <3>
    start: ExampleStartState
    events: <4>
      - name: outEvent1 <5>
        source: ''
        kind: produced
        type: out-event-type1 <6>
    ...
----

<1> Name of the Knative Eventing Broker to use for all the events produced by the workflow, including the SonataFlow system events.
<2> Defines the namespace of the Knative Eventing Broker. If you do not specify a value, the parameter defaults to the `SonataFlow` namespace. Consider creating the broker in the same namespace as `SonataFlow`.
<3> Flow definition field in the `SonataFlow` CR.
<4> Events definition field in the `SonataFlow` CR.
<5> Example of an outgoing event `outEvent1` definition.
<6> Event type for the `outEvent1` outgoing event.

[id="serverless-logic-incoming-eventing-system-config_{context}"]
== Incoming eventing system configuration

To configure incoming events, you can use the `spec.sources[]` field in the `SonataFlow` CR. You can add an entry for each event type requiring specific configuration. This setup allows workflows to consume events from different brokers based on event type.

If an incoming event type lacks a specific Broker configuration, the system applies eventing system configuration precedence rules.

The following example displays how to configure the `SonataFlow` CR for a workflow-scoped incoming eventing system:

[NOTE]
====
The link between a `spec.sources[]` entry and the workflow event, is by using the event type.
====
 
[source,yaml]
----
apiVersion: sonataflow.org/v1alpha08
kind: SonataFlow
metadata:
  name: example-workflow
  namespace: example-workflow-namespace
  annotations:
    sonataflow.org/description: Example Workflow
    sonataflow.org/version: 0.0.1
    sonataflow.org/profile: preview
spec:
  sources:
    - eventType: in-event-type1 <1>
      ref:
        name: incoming-example-broker1 <2>
        namespace: incoming-example-broker1-namespace <3>
        apiVersion: eventing.knative.dev/v1
        kind: Broker
    - eventType: in-event-type2 <4>
      ref:
        name: incoming-example-broker2 <5>
        namespace: incoming-example-broker2-namespace <6>
        apiVersion: eventing.knative.dev/v1
        kind: Broker
  flow: <7>
    start: ExampleStartState
    events: <8>
      - name: inEvent1 <9>
        source: ''
        kind: consumed
        type: in-event-type1 <10>
      - name: inEvent2 <11>
        source: ''
        kind: consumed
        type: in-event-type2 <12>
    ...
----

<1> Configure the workflow to consume events of type `in-event-type1` using the specified Knative Eventing Broker.
<2> Name of the Knative Eventing Broker to use for the consumption of the events of type `in-event-type1` sent to this workflow.
<3> Optional: If you do not specify the value, the parameter defaults to the `SonataFlow` namespace. Consider creating the broker in the same namespace as the `SonataFlow` workflow.
<4> Configure the workflow to consume events of type `in-event-type2` using the specified Knative Eventing Broker.
<5> Name of the Knative Eventing Broker to use for the consumption of the events of type `in-event-type2` sent to this workflow.
<6> Optional: If you do not specify the value, the parameter defaults to the `SonataFlow` namespace. Consider creating the broker in the same namespace as the `SonataFlow` workflow.
<7> Flow definition field in the `SonataFlow` CR.
<8> Events definition field in the `SonataFlow` CR.
<9> Example of an incoming event `inEvent1` definition.
<10> Event type for the incoming event `inEvent1`. The link of the workflow event, with the corresponding `spec.sources[]` entry, is by using the event type name `in-event-type1`.
<11> Example of an incoming event `inEvent2` definition.
<12> Event type for the incoming event `inEvent2`. The link of the workflow event, with the corresponding spec.sources[] entry, is created by using the event type name in-event-type2.