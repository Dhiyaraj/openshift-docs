// Module included in the following assemblies:
//
// * serverless/eventing/event-sinks/serverless-jobsink.adoc

:_content-type: PROCEDURE
[id="serverless-using-jobsink_{context}"]
= Using JobSink

When an event is sent to a `JobSink`, Eventing creates a `Job` and mounts the received event as JSON file at `/etc/jobsink-event/event`.

.Procedure

. Create a `JobSink` object definition as a YAML file:
+
.JobSink YAML
[source,yaml]
----
apiVersion: sinks.knative.dev/v1alpha1
kind: JobSink
metadata:
  name: job-sink-logger
spec:
  job:
    spec:
      completions: 1
      parallelism: 1
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: main
              image: docker.io/library/bash:5
              command: [ "cat" ]
              args:
                - "/etc/jobsink-event/event"
----

. Apply the `JobSink` YAML file:
+
[source,terminal]
----
$ oc apply -f <job-sink-file.yaml>
----

. Verify `JobSink` is ready:
+
[source,terminal]
----
$ oc get jobsinks.sinks.knative.dev
----
Example output:
+
[source,terminal]
----
NAME              URL                                                                          AGE   READY   REASON
job-sink-logger   http://job-sink.knative-eventing.svc.cluster.local/default/job-sink-logger   5s    True
----

. Trigger a `JobSink`. `JobSink` can be triggered by any event source or trigger.
+
[source,terminal]
----
$ oc run curl --image=curlimages/curl --rm=true --restart=Never -ti -- -X POST -v \
   -H "content-type: application/json"  \
   -H "ce-specversion: 1.0" \
   -H "ce-source: my/curl/command" \
   -H "ce-type: my.demo.event" \
   -H "ce-id: 123" \
   -d '{"details":"JobSinkDemo"}' \
   http://job-sink.knative-eventing.svc.cluster.local/default/job-sink-logger
----
. Verify a `Job` is created:
+
[source,terminal]
----
$ oc logs job-sink-loggerszoi6-dqbtq
----
Example output: 
+
[source,terminal]
----
{"specversion":"1.0","id":"123","source":"my/curl/command","type":"my.demo.event","datacontenttype":"application/json","data":{"details":"JobSinkDemo"}}
----

[NOTE]
====
JobSink creates a `Job` for each unique event it receives.

An event is uniquely identified by the combination of its `source` and `id` attributes.

If an event with the same attributes is received while a `Job` for that event already exists, another `Job` will not be created.
====
